<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WalletConnect v2 + Ethers</title>

<!-- Web3Modal v2 -->
<script src="https://cdn.jsdelivr.net/npm/@web3modal/walletconnect@2.7.1/dist/index.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@web3modal/ethereum@2.7.1/dist/index.umd.js"></script>

<!-- Ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
  body { background:#111; color:white; text-align:center; font-family:Arial; padding-top:40px; }
  button { padding:12px 20px; border-radius:8px; font-size:1.1rem; background:#1e88e5; color:white; border:none; cursor:pointer; margin:10px; }
</style>
</head>

<body>

<h1>WalletConnect v2 Demo</h1>
<p>Connect your wallet using Web3Modal v2</p>

<button id="connectBtn">üîó Connect Wallet</button>
<button id="signBtn" disabled>‚úçÔ∏è Sign Message (Off-Chain)</button>
<button id="txBtn" disabled>üí∏ Send Transaction (On-Chain)</button>

<script>
/* -------------------------------------------------
   WALLETCONNECT V2 CONFIG
------------------------------------------------- */
const projectId = "0e7d96df89f873ddfb0b4381e13c883c"; // <-- your real projectId

const chains = [
  {
    id: 1,
    name: "Ethereum",
    rpcUrl: "https://rpc.ankr.com/eth"
  }
];

const metadata = {
  name: "Zomyto Wallet",
  description: "WalletConnect v2 Demo",
  url: "https://yourwebsite.com",
  icons: ["https://avatars.githubusercontent.com/u/37784886"]
};

// Create Web3Modal instance
const modal = new walletconnect.WalletConnectModal({
  projectId,
  chains,
  metadata
});

let provider, signer;

/* -------------------------------------------------
   CONNECT WALLET
------------------------------------------------- */
document.getElementById("connectBtn").onclick = async () => {
  try {
    const session = await modal.connect();
    const wcProvider = new walletconnect.WalletConnectProvider(session);

    provider = new ethers.providers.Web3Provider(wcProvider);
    signer = provider.getSigner();

    document.getElementById("signBtn").disabled = false;
    document.getElementById("txBtn").disabled = false;

    alert("Wallet Connected!");
  } catch (err) {
    console.error("Connect error:", err);
    alert("Failed to connect wallet.");
  }
};

/* -------------------------------------------------
   OFF-CHAIN SIGNED MESSAGE
------------------------------------------------- */
document.getElementById("signBtn").onclick = async () => {
  try {
    const address = await signer.getAddress();
    const message = `Zomyto Signature Approval\nAddress: ${address}\nTime: ${Date.now()}`;

    const signature = await signer.signMessage(message);

    console.log("Signature:", signature);
    alert("Message signed successfully!");
  } catch (err) {
    console.error(err);
    alert("Signing error: " + err.message);
  }
};

/* -------------------------------------------------
   ON-CHAIN TRANSACTION (example)
------------------------------------------------- */
document.getElementById("txBtn").onclick = async () => {
  try {
    const address = await signer.getAddress();

    const tx = await signer.sendTransaction({
      to: address,
      value: ethers.utils.parseEther("0.00001") // Self-send tiny amount
    });

    await tx.wait();
    alert("Transaction sent!");
  } catch (err) {
    console.error(err);
    alert("Transaction error: " + err.message);
  }
};
</script>

</body>
</html>
